<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Prompts - 2025 Reading Challenge</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/ios-icon.png">
  <meta name="theme-color" content="#247182" />
  <meta name="apple-mobile-web-app-status-bar-style" content="#247182">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="menu.css">
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: #f4f4f4;
      color: #333;
    }

    .container {
      max-width: 1100px;
      margin: 6rem auto 3rem;
      padding: 0 1rem;
    }

    h1 {
      font-size: 2.5rem;
      color: #247182;
      font-weight: 800;
      text-align: center;
      margin-bottom: 1rem;
    }

    #filterButtons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .filter-btn {
      background: white;
      color: #247182;
      border: 2px solid #247182;
      border-radius: 30px;
      padding: 0.5rem 1rem;
      font-family: 'Poppins', sans-serif;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s ease;
    }

    .filter-btn:hover,
    .filter-btn.active {
      background: #247182;
      color: white;
    }

    input[type="text"] {
      width: 100%;
      max-width: 400px;
      padding: 0.75rem;
      border: 2px solid #247182;
      border-radius: 8px;
      margin: 0 auto 1rem;
      display: block;
      font-size: 1rem;
      font-family: 'Poppins', sans-serif;
    }

    .prompt-grid {
      display: grid;
      gap: 1.5rem;
      grid-template-columns: repeat(1, 1fr);
    }

    @media (min-width: 700px) {
      .prompt-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    /* ðŸŽ¬ Animated prompt cards */
.prompt-card {
  background: white;
  border-radius: 1rem;
  padding: 1.5rem;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  cursor: pointer;

  /* Smooth hover transition */
  transition: transform 0.25s ease, box-shadow 0.25s ease;

  /* Entrance animation */
  opacity: 0;
  transform: translateY(10px);
  animation: promptIn 0.35s ease forwards;
  animation-delay: var(--delay, 0s);
}

/* Strong scale hover â€” identical to homepage behavior */
.prompt-card:hover {
  transform: scale(1.03);
  box-shadow: 0 6px 14px rgba(0,0,0,0.14);
}

    .prompt-card.grayed-out {
      color: #cccccc;
    }

    .prompt-card h2 {
      font-size: 1rem;
      color: #247182;
      margin: 0 0 0.5rem;
      font-style: normal;
    }

    .prompt-card h3 {
      font-size: 1.25rem;
      font-weight: 800;
      margin: 0 0 0.5rem;
      color: inherit;
    }

    .prompt-card p,
    .prompt-card .creator {
      font-size: 0.9rem;
      margin: 0;
      color: inherit;
    }

    @keyframes promptIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Respect reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
      .prompt-card {
        animation: none !important;
        opacity: 1;
        transform: none;
      }
    }

    .footer-logo-container {
      width: 350px;
      height: 140px;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .footer-logo {
      width: 100%;
      height: auto;
    }

    .site-footer {
      margin-top: 3rem;
      padding: 2rem 1rem;
      background-color: transparent;
      display: flex;
      justify-content: center;
    }
  </style>
</head>
<body>
  <header id="main-header">
    <div class="site-name">
      <img src="favicon.png" alt="Icon" />
      <span class="desktop-title">2025 Reading Challenge</span>
    </div>
    <nav class="menu"></nav>
    <button class="menu-toggle" id="menu-button">&#9776;</button>
  </header>

  <div class="mobile-menu" id="mobileMenu"></div>

  <div class="container">
    <h1>Prompts</h1>
    <input type="text" id="searchInput" placeholder="Search prompts..." />
    <div id="filterButtons" class="filter-buttons-container"></div>
    <div id="promptGrid" class="prompt-grid"></div>
  </div>

  <footer class="site-footer">
    <div class="footer-logo-container">
      <img src="reading-challenge-logo.png" alt="Reading Challenge Logo" class="footer-logo" />
    </div>
  </footer>

  <!-- Confetti library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <script src="menu-config.js"></script>
  <script src="menu.js"></script>
  <script src="prompts.js"></script>

  <script>
    window.prompts = allPrompts;
    const PARTICIPANTS = ["Cassy", "Cindy", "Noah", "Rusty", "Winny", "Zoey"];
    let allSubmissions = [];
    let activeParticipant = null;

    // Confetti helper for Cindy
    function launchConfetti() {
      if (typeof confetti !== "function") return;

      const duration = 2000; // 2 seconds
      const end = Date.now() + duration;

      (function frame() {
        confetti({
          particleCount: 10,
          angle: 60,
          spread: 100,
          origin: { x: 0, y: 0.8 }
        });
        confetti({
          particleCount: 10,
          angle: 120,
          spread: 100,
          origin: { x: 1, y: 0.8 }
        });

        if (Date.now() < end) {
          requestAnimationFrame(frame);
        }
      })();
    }

    // Renders participant filter buttons (no Clear Filter button)
    function renderFilterButtons() {
      const container = document.getElementById("filterButtons");
      container.innerHTML = "";

      PARTICIPANTS.forEach(name => {
        const btn = document.createElement("button");
        btn.className = "filter-btn";
        btn.textContent = name;

        btn.onclick = () => {
  const wasActive = activeParticipant === name;

  // ðŸŽ‰ Only fire confetti when Cindy is newly selected
  if (!wasActive && name === "Cindy") {
    launchConfetti();
  }

  activeParticipant = wasActive ? null : name;
  renderFilterButtons();
  renderPrompts(window.prompts);
};

        if (activeParticipant === name) {
          btn.classList.add("active");
        }

        container.appendChild(btn);
      });
    }

    // Apply or remove gray-out based on allSubmissions + activeParticipant
    function updateGrayOut() {
      const cards = document.querySelectorAll(".prompt-card");

      cards.forEach(card => {
        const num = parseInt(card.dataset.promptNumber, 10);

        if (
          activeParticipant &&
          allSubmissions.some(
            s => s.Reader === activeParticipant && s.Prompt === num
          )
        ) {
          card.classList.add("grayed-out");
        } else {
          card.classList.remove("grayed-out");
        }
      });
    }

    function renderPrompts(prompts) {
      const grid = document.getElementById("promptGrid");
      const input = document.getElementById("searchInput");
      const search = input.value.toLowerCase();

      grid.innerHTML = "";
      const filteredPrompts = prompts.filter(p =>
        p.title.toLowerCase().includes(search) ||
        (p.description && p.description.toLowerCase().includes(search))
      );

      if (filteredPrompts.length === 0) {
        grid.innerHTML = "<p style='text-align:center; color: #999;'>No prompts found.</p>";
        return;
      }

      filteredPrompts.forEach((p, index) => {
        const card = document.createElement("div");
        card.className = "prompt-card";

        // Staggered animation delay per card
        const delayMs = index * 70; // tweak 50â€“100ms if you want faster/slower cascade
        card.style.setProperty("--delay", `${delayMs}ms`);

        // Store prompt number on the card for later gray-out updates
        card.dataset.promptNumber = p.number;

        card.onclick = () => { location.href = `/prompt.html?number=${p.number}`; };
        card.innerHTML = `
          <h2>Prompt #${p.number}</h2>
          <h3>${p.title}</h3>
          ${p.description ? `<p>${p.description}</p>` : ""}
          <p class="creator">By ${p.creator}</p>
        `;
        grid.appendChild(card);
      });

      // After drawing cards, apply gray-out if we already have submissions loaded
      if (allSubmissions.length > 0) {
        updateGrayOut();
      }
    }

    async function fetchSubmissions() {
      const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRvhJbih4ugNXcDFt7yE5JidKzzVutkd76c3UCzTKCOB0u-ZlG3SFUgd4ZekhMjgsFWBcMnY7ukYTAE/pub?output=csv";
      const res = await fetch(sheetUrl);
      const csv = await res.text();

      const parsed = Papa.parse(csv, { header: true });
      allSubmissions = parsed.data
        .map(row => ({
          Reader: row.Reader?.trim(),
          Prompt: parseInt(row.Prompt?.trim())
        }))
        .filter(row => row.Reader && !isNaN(row.Prompt));

      // Once we have data, update gray-out on existing cards
      updateGrayOut();
    }

    // Make buttons & prompts appear immediately; fetch submissions in background
    window.addEventListener("DOMContentLoaded", () => {
      if (typeof prompts !== "undefined") window.prompts = prompts;

      // Show UI right away
      renderFilterButtons();
      renderPrompts(window.prompts);

      // Fetch submissions; once ready, update gray-out in place (no re-animation)
      fetchSubmissions().catch(err => {
        console.error("Error fetching submissions:", err);
      });

      document.getElementById("searchInput").addEventListener("input", () => {
        renderPrompts(window.prompts);
      });
    });
  </script>
</body>
</html>
